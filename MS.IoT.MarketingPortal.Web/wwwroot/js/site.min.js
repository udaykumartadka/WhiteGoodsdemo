var app=angular.module("MSIoT",[]);app.controller("homectrl",function(){$("#videoModal").on("shown.bs.modal",function(){$("#videoShow")[0].play()});$("#videoModal").on("hidden.bs.modal",function(){$("#videoShow")[0].pause()})});app.controller("getStartedController",function(){});app.controller("deployController",function(n,t,i){function u(){t.post("/api/resourcemanager/deploy/status",n.deployStatusRequest).then(function(t){n.deployStatusResponse=t.data;n.deployStatusResponse.properties.provisioningState==="Succeeded"&&(n.stopInterval(),n.ConfigureApplication())})}n.isError=!1;n.isPageLoading=!0;n.isSubmitDisabled=!1;n.isLoading=!1;n.isDeployed=!1;n.isAnySubscription=!1;n.isAppCreating=!1;n.isAppCreated=!1;n.isAppDeploying=!1;n.isAppDeployed=!1;n.isAppConfiguring=!1;n.isAppConfigured=!1;var r;t.get("/api/resourcemanager/subscriptions").then(function(t){n.isPageLoading=!1;n.subscriptions=t.data;n.subscriptions.subscriptionList.length===0&&(n.isAnySubscription=!0,n.isDeployed=!0)},function(t){n.errorMessage=t.data.Message;n.isError=!0;n.isPageLoading=!1});n.getLocations=function(){t.get("/api/resourcemanager/subscriptions/"+n.deploy.subscription.SubscriptionId+"/locations").then(function(t){n.locations=t.data})};n.deployTemplate=function(){n.submitted=!0;n.provision.$valid===!0&&(n.isSubmitDisabled=!0,n.isLoading=!0,n.isAppCreating=!0,n.isAppCreatingText=!0,n.appData={applicationName:n.deploy.applicationName,subscriptionId:n.deploy.subscription.subscriptionId,location:n.deploy.location.name},t.post("/api/serviceprincipal/create",n.appData).then(function(f){n.aadApplication=f.data;n.isAppCreating=!1;n.isAppCreated=!0;n.isAppDeploying=!0;n.isAppDeployingText=!0;var e={applicationName:n.deploy.applicationName,subscriptionId:n.deploy.subscription.subscriptionId,location:n.deploy.location.name,clientId:n.aadApplication.clientId,clientSecret:n.aadApplication.clientSecret,tenantId:n.aadApplication.tenantId};t.post("/api/resourcemanager/deploy",e).then(function(t){n.deploySuccess=t.data;n.deployStatusRequest={applicationName:n.appData.applicationName,subscriptionId:n.appData.subscriptionId};r=i(u,1e4)},function(t){n.errorMessage=t.data.Message;n.isError=!0;n.isLoading=!1;n.isAppCreatingText=!1;n.isAppDeploying=!1;n.isAppDeployingText=!1;n.isAppCreated=!1})}))};n.stopInterval=function(){angular.isDefined(r)&&(i.cancel(r),r=undefined)};n.ConfigureApplication=function(){var i,r;n.isAppDeploying=!1;n.isAppDeployed=!0;i={appObjectId:n.aadApplication.appObjectId,homePage:n.deployStatusResponse.dataPacketDesignerUrl.value,replyUrls:[n.deployStatusResponse.dataPacketDesignerUrl.value,n.deployStatusResponse.deviceManagementPortalUrl.value]};n.isAppConfiguring=!0;n.isAppConfiguringText=!0;t.put("/api/serviceprincipal/application/update",i).then(function(t){n.updateSuccess=t.data;n.isAppConfigured=!1;n.isAppConfiguring=!1;n.isAppDeployed=!1;n.isAppCreated=!1;n.isAppConfigured=!1;n.isSubmitDisabled=!1;n.isLoading=!1;n.isDeployed=!0;n.isAppCreatingText=!1;n.isAppDeployingText=!1;n.isAppConfiguringText=!1});r={cosmosDBAccountEndPoint:n.deployStatusResponse.cosmosDBAccountEndPoint.value,cosmosDBAccountKey:n.deployStatusResponse.cosmosDBAccountKey.value};t.post("/api/commonTemplates/generate",r).then(function(i){n.templateSuccess=i.data;var r={resourceGroupName:n.deploy.applicationName,subscriptionId:n.deploy.subscription.subscriptionId,location:n.deploy.location.name,ioTHubName:n.deployStatusResponse.iotHubName.value,cosmosDBAccountName:n.deployStatusResponse.cosmosDBAccountName.value,cosmosDBName:"MSIoT",cosmosDBMessageCollectionName:"Messages"};t.post("/api/resourcemanager/deploystreamanalytics",r).then(function(t){n.templateASASuccess=t.data})})}});